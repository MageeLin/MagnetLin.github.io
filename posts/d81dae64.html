<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/bangchui-32x32-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/bangchui-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/bangchui-16x16-next.png">
  <link rel="mask-icon" href="/images/bangchui-logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://linjingyi.cn').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="本篇分析下pull家族的方法，包括pull、pullAll、pullAllBy、pullAllWith、pullAt以及核心方法basePullAll、basePullAt。顺便分析依赖到的 lodash 方法memoize，最后给出pull方法的原生实现。 具体的依赖路径图如下所示：  另外，在 basePullAt 方法的源码中发现一个 bug，在数组中多次列出同一个要删除的元素索引的情况下，">
<meta property="og:type" content="article">
<meta property="og:title" content="lodash源码解析：pull家族">
<meta property="og:url" content="https://linjingyi.cn/posts/d81dae64.html">
<meta property="og:site_name" content="林景宜的记事本">
<meta property="og:description" content="本篇分析下pull家族的方法，包括pull、pullAll、pullAllBy、pullAllWith、pullAt以及核心方法basePullAll、basePullAt。顺便分析依赖到的 lodash 方法memoize，最后给出pull方法的原生实现。 具体的依赖路径图如下所示：  另外，在 basePullAt 方法的源码中发现一个 bug，在数组中多次列出同一个要删除的元素索引的情况下，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://linjingyi.cn/posts/d81dae64/pull.svg">
<meta property="article:published_time" content="2020-09-08T12:21:06.000Z">
<meta property="article:modified_time" content="2020-09-08T12:21:06.000Z">
<meta property="article:author" content="林景宜">
<meta property="article:tag" content="lodash">
<meta property="article:tag" content="源码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://linjingyi.cn/posts/d81dae64/pull.svg">

<link rel="canonical" href="https://linjingyi.cn/posts/d81dae64.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>lodash源码解析：pull家族 | 林景宜的记事本</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e7bf681a68fc68b663d40333164a4df9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">林景宜的记事本</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">爱囡囡，最无双</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://linjingyi.cn/posts/d81dae64.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bangchui-logo.svg">
      <meta itemprop="name" content="林景宜">
      <meta itemprop="description" content="一个已婚的前端er">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林景宜的记事本">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          lodash源码解析：pull家族
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-08 20:21:06" itemprop="dateCreated datePublished" datetime="2020-09-08T20:21:06+08:00">2020-09-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/JS/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" itemprop="url" rel="index">
                    <span itemprop="name">源码解析</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/JS/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/lodash/" itemprop="url" rel="index">
                    <span itemprop="name">lodash</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本篇分析下<code>pull</code>家族的方法，包括<code>pull</code>、<code>pullAll</code>、<code>pullAllBy</code>、<code>pullAllWith</code>、<code>pullAt</code>以及核心方法<code>basePullAll</code>、<code>basePullAt</code>。顺便分析依赖到的 lodash 方法<code>memoize</code>，最后给出<code>pull</code>方法的原生实现。</p>
<p>具体的依赖路径图如下所示：</p>
<p><img src="/posts/d81dae64/pull.svg" alt></p>
<p>另外，在 <code>basePullAt</code> 方法的源码中发现一个 <code>bug</code>，在数组中多次列出同一个要删除的元素索引的情况下，会导致方法执行结果不对，删除元素过多。但是在打包好文件中将 <code>let</code> 变为了 <code>var</code> 并挪动了位置，掩盖了这个 <code>bug</code>。</p>
<a id="more"></a>

<h2 id="依赖的内置方法"><a href="#依赖的内置方法" class="headerlink" title="依赖的内置方法"></a>依赖的内置方法</h2><h3 id="baseAt"><a href="#baseAt" class="headerlink" title="baseAt"></a>baseAt</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">get</span> from '../<span class="keyword">get</span>.js';</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * `at`方法的基础实现，不用支持单个的路径</span><br><span class="line"> *</span><br><span class="line"> * @private</span><br><span class="line"> * @param &#123;<span class="built_in">Object</span>&#125; object 要迭代的对象</span><br><span class="line"> * @param &#123;string[]&#125; paths 要获取的对象的元素路径数组</span><br><span class="line"> * @returns &#123;<span class="built_in">Array</span>&#125; 返回要获取的元素组成的数组</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">function baseAt(object, paths) &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 初始化</span></span><br><span class="line"><span class="regexp">  let index = -1;</span></span><br><span class="line"><span class="regexp">  const length = paths.length;</span></span><br><span class="line"><span class="regexp">  const result = new Array(length);</span></span><br><span class="line"><span class="regexp">  const skip = object == null;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 迭代</span></span><br><span class="line"><span class="regexp">  while (++index &lt; length) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ object为null或undefined时，就返回undefined</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 否则就给result对应位置赋值get();</span></span><br><span class="line"><span class="regexp">    result[index] = skip ? undefined : get(object, paths[index]);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return result;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default baseAt;</span></span><br></pre></td></tr></table></figure>

<h3 id="baseGet"><a href="#baseGet" class="headerlink" title="baseGet"></a>baseGet</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> castPath <span class="keyword">from</span> <span class="string">'./castPath.js'</span>;</span><br><span class="line"><span class="keyword">import</span> toKey <span class="keyword">from</span> <span class="string">'./toKey.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `get`方法的基础实现，不用支持默认值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>object 要检索的对象。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array|string&#125;</span> </span>path 要获取属性的路径。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>返回解析的值。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baseGet</span>(<span class="params">object, path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 拿到路径数组</span></span><br><span class="line">  path = castPath(path, object);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> length = path.length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 迭代，一级级向下拿到最终的值</span></span><br><span class="line">  <span class="keyword">while</span> (object != <span class="literal">null</span> &amp;&amp; index &lt; length) &#123;</span><br><span class="line">    object = object[toKey(path[index++])];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// index == length，也就是执行到底时，返回最终的值</span></span><br><span class="line">  <span class="keyword">return</span> index &amp;&amp; index == length ? object : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> baseGet;</span><br></pre></td></tr></table></figure>

<h3 id="baseIndexOfWith"><a href="#baseIndexOfWith" class="headerlink" title="baseIndexOfWith"></a>baseIndexOfWith</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该函数类似`baseIndexOf`，但是接受一个comparator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要检查的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 要搜索的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>fromIndex 开始搜索位置处的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>comparator 比较器comparator调用每个元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;number&#125;</span> </span>返回匹配值得索引，否则返回`-1`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baseIndexOfWith</span>(<span class="params">array, value, fromIndex, comparator</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 从设定的索引处开始</span></span><br><span class="line">  <span class="keyword">let</span> index = fromIndex - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 这里用了解构方式获取length，赞成</span></span><br><span class="line">  <span class="keyword">const</span> &#123; length &#125; = array;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始迭代</span></span><br><span class="line">  <span class="keyword">while</span> (++index &lt; length) &#123;</span><br><span class="line">    <span class="comment">// 拿array的每一个元素通过comparator的方式与value做对比</span></span><br><span class="line">    <span class="keyword">if</span> (comparator(array[index], value)) &#123;</span><br><span class="line">      <span class="comment">// 找到了就返回索引</span></span><br><span class="line">      <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 找不到就返回-1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> baseIndexOfWith;</span><br></pre></td></tr></table></figure>

<h3 id="baseUnset"><a href="#baseUnset" class="headerlink" title="baseUnset"></a>baseUnset</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> castPath <span class="keyword">from</span> <span class="string">'./castPath.js'</span>;</span><br><span class="line"><span class="keyword">import</span> last <span class="keyword">from</span> <span class="string">'../last.js'</span>;</span><br><span class="line"><span class="keyword">import</span> parent <span class="keyword">from</span> <span class="string">'./parent.js'</span>;</span><br><span class="line"><span class="keyword">import</span> toKey <span class="keyword">from</span> <span class="string">'./toKey.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `unset`方法的基础实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>object 要修改的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array|string&#125;</span> </span>path 要移除的属性路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;boolean&#125;</span> </span>如果删除成功，那么返回 `true` ，否则返回 `false`。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baseUnset</span>(<span class="params">object, path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取属性路径数组</span></span><br><span class="line">  path = castPath(path, object);</span><br><span class="line">  <span class="comment">// 获取父级属性值的引用</span></span><br><span class="line">  object = parent(object, path);</span><br><span class="line">  <span class="comment">// 在父级属性值中删掉该属性</span></span><br><span class="line">  <span class="keyword">return</span> object == <span class="literal">null</span> || <span class="keyword">delete</span> object[toKey(last(path))];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> baseUnset;</span><br></pre></td></tr></table></figure>

<h3 id="castPath"><a href="#castPath" class="headerlink" title="castPath"></a>castPath</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isKey <span class="keyword">from</span> <span class="string">'./isKey.js'</span>;</span><br><span class="line"><span class="keyword">import</span> stringToPath <span class="keyword">from</span> <span class="string">'./stringToPath.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当`value`不是单独值的时候，返回path数组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 要检查的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>[object] 要查询key的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回转换换后的属性路径数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">castPath</span>(<span class="params">value, object</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// value是数组的时候直接返回value</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果value是一个key，就用数组包起来，否则调用stringToPath</span></span><br><span class="line">  <span class="keyword">return</span> isKey(value, object) ? [value] : stringToPath(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> castPath;</span><br></pre></td></tr></table></figure>

<h3 id="compareAscending"><a href="#compareAscending" class="headerlink" title="compareAscending"></a>compareAscending</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isSymbol <span class="keyword">from</span> <span class="string">'../isSymbol.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较value，并用升序排序</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 要比较的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>other 另一个要比较的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;number&#125;</span> </span>返回`value`的是否升序排列的指示符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compareAscending</span>(<span class="params">value, other</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 两个值不完全相等</span></span><br><span class="line">  <span class="keyword">if</span> (value !== other) &#123;</span><br><span class="line">    <span class="comment">// value是否不为undefined</span></span><br><span class="line">    <span class="keyword">const</span> valIsDefined = value !== <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">// value是否为null</span></span><br><span class="line">    <span class="keyword">const</span> valIsNull = value === <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// value是否是自己本身</span></span><br><span class="line">    <span class="keyword">const</span> valIsReflexive = value === value;</span><br><span class="line">    <span class="comment">// value是否为symbol</span></span><br><span class="line">    <span class="keyword">const</span> valIsSymbol = isSymbol(value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同上</span></span><br><span class="line">    <span class="keyword">const</span> othIsDefined = other !== <span class="literal">undefined</span>;</span><br><span class="line">    <span class="keyword">const</span> othIsNull = other === <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> othIsReflexive = other === other;</span><br><span class="line">    <span class="keyword">const</span> othIsSymbol = isSymbol(other);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果value为字符串</span></span><br><span class="line">    <span class="keyword">const</span> val =</span><br><span class="line">      <span class="keyword">typeof</span> value === <span class="string">'string'</span></span><br><span class="line">        ? <span class="comment">// 是就执行字符串比较的结果</span></span><br><span class="line">          value.localeCompare(other)</span><br><span class="line">        : <span class="comment">// 否的话就转为负</span></span><br><span class="line">          -other;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面是进行顺序比较</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (!othIsNull &amp;&amp; !othIsSymbol &amp;&amp; !valIsSymbol &amp;&amp; val &gt; <span class="number">0</span>) ||</span><br><span class="line">      (valIsSymbol &amp;&amp;</span><br><span class="line">        othIsDefined &amp;&amp;</span><br><span class="line">        othIsReflexive &amp;&amp;</span><br><span class="line">        !othIsNull &amp;&amp;</span><br><span class="line">        !othIsSymbol) ||</span><br><span class="line">      (valIsNull &amp;&amp; othIsDefined &amp;&amp; othIsReflexive) ||</span><br><span class="line">      (!valIsDefined &amp;&amp; othIsReflexive) ||</span><br><span class="line">      !valIsReflexive</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (!valIsNull &amp;&amp; !valIsSymbol &amp;&amp; !othIsSymbol &amp;&amp; val &lt; <span class="number">0</span>) ||</span><br><span class="line">      (othIsSymbol &amp;&amp;</span><br><span class="line">        valIsDefined &amp;&amp;</span><br><span class="line">        valIsReflexive &amp;&amp;</span><br><span class="line">        !valIsNull &amp;&amp;</span><br><span class="line">        !valIsSymbol) ||</span><br><span class="line">      (othIsNull &amp;&amp; valIsDefined &amp;&amp; valIsReflexive) ||</span><br><span class="line">      (!othIsDefined &amp;&amp; valIsReflexive) ||</span><br><span class="line">      !othIsReflexive</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果两个值完全相等===，则返回0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compareAscending;</span><br></pre></td></tr></table></figure>

<h3 id="copyArrayAt"><a href="#copyArrayAt" class="headerlink" title="copyArrayAt"></a>copyArrayAt</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 复制`source`的值到`array`中</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>source 复制值的来源</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>[array=[]] 要复制到的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyArray</span>(<span class="params">source, array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">const</span> length = source.length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// array若是空，就把array设为与source等长的空数组</span></span><br><span class="line">  array || (array = <span class="keyword">new</span> <span class="built_in">Array</span>(length));</span><br><span class="line">  <span class="comment">// 开始迭代</span></span><br><span class="line">  <span class="keyword">while</span> (++index &lt; length) &#123;</span><br><span class="line">    <span class="comment">// 把每个值复制过去，所以是个浅拷贝</span></span><br><span class="line">    array[index] = source[index];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> copyArray;</span><br></pre></td></tr></table></figure>

<h3 id="isKey"><a href="#isKey" class="headerlink" title="isKey"></a>isKey</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isSymbol <span class="keyword">from</span> <span class="string">'../isSymbol.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 用于匹配属性路径中的属性名称。 */</span></span><br><span class="line"><span class="comment">// 带有深度路径属性名的正则</span></span><br><span class="line"><span class="keyword">const</span> reIsDeepProp = <span class="regexp">/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/</span>;</span><br><span class="line"><span class="comment">// 直接属性名的正则</span></span><br><span class="line"><span class="keyword">const</span> reIsPlainProp = <span class="regexp">/^\w*$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查`value`是一个属性名并且不是一个属性路径</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 要检查的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>[object] 要查询key的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;boolean&#125;</span> </span>如果时一个属性名则返回`true`，否则返回`false`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isKey</span>(<span class="params">value, object</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 如果是个数组，则返回false</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> type = <span class="keyword">typeof</span> value;</span><br><span class="line">  <span class="comment">// 如果typeof结果是个number、boolean或者value直接为null或者value是个symbol，则返回true</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    type === <span class="string">'number'</span> ||</span><br><span class="line">    type === <span class="string">'boolean'</span> ||</span><br><span class="line">    value == <span class="literal">null</span> ||</span><br><span class="line">    isSymbol(value)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 直接属性名正则验证 || 带深度的属性名验证 || 或value在object上能查询到</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    reIsPlainProp.test(value) ||</span><br><span class="line">    !reIsDeepProp.test(value) ||</span><br><span class="line">    (object != <span class="literal">null</span> &amp;&amp; value <span class="keyword">in</span> <span class="built_in">Object</span>(object))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> isKey;</span><br></pre></td></tr></table></figure>

<h3 id="memoizeCapped"><a href="#memoizeCapped" class="headerlink" title="memoizeCapped"></a>memoizeCapped</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> memoize <span class="keyword">from</span> <span class="string">'../memoize.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 用于memoize缓存的最大条数 */</span></span><br><span class="line"><span class="keyword">const</span> MAX_MEMOIZE_SIZE = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `memoize`方法的特殊版本，当缓存数超过`MAX_MEMOIZE_SIZE`时会清理memoized</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>func 将该函数的输出缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Function&#125;</span> </span>返回一个新的memoized函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoizeCapped</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 这里借用resolver函数，计算result.cache的size</span></span><br><span class="line">  <span class="keyword">const</span> result = memoize(func, (key) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; cache &#125; = result;</span><br><span class="line">    <span class="comment">// 当size达到300时，清理cache</span></span><br><span class="line">    <span class="keyword">if</span> (cache.size === MAX_MEMOIZE_SIZE) &#123;</span><br><span class="line">      cache.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> memoizeCapped;</span><br></pre></td></tr></table></figure>

<h3 id="parent"><a href="#parent" class="headerlink" title="parent"></a>parent</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> baseGet <span class="keyword">from</span> <span class="string">'./baseGet.js'</span>;</span><br><span class="line"><span class="keyword">import</span> slice <span class="keyword">from</span> <span class="string">'../slice.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取`object`上`path`的父级属性值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>object 要查询的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>path 要获取父级属性值的路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>返回父级属性值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parent</span>(<span class="params">object, path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当length小于2，也就是length == 1时，直接就返回object</span></span><br><span class="line">  <span class="comment">// 否则，就用baseGet获取（去掉最后一个路径的）路径数组对应的值</span></span><br><span class="line">  <span class="keyword">return</span> path.length &lt; <span class="number">2</span> ? object : baseGet(object, slice(path, <span class="number">0</span>, <span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> parent;</span><br></pre></td></tr></table></figure>

<h3 id="stringToPath"><a href="#stringToPath" class="headerlink" title="stringToPath"></a>stringToPath</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> memoizeCapped <span class="keyword">from</span> <span class="string">'./memoizeCapped.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点的charCode</span></span><br><span class="line"><span class="keyword">const</span> charCodeOfDot = <span class="string">'.'</span>.charCodeAt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 转义字符正则表达式</span></span><br><span class="line"><span class="keyword">const</span> reEscapeChar = <span class="regexp">/\\(\\)?/g</span>;</span><br><span class="line"><span class="comment">// 属性名正则表达式</span></span><br><span class="line"><span class="keyword">const</span> rePropName = <span class="built_in">RegExp</span>(</span><br><span class="line">  <span class="comment">// 匹配不是.或括号的任意值</span></span><br><span class="line">  <span class="string">'[^.[\\]]+'</span> +</span><br><span class="line">    <span class="string">'|'</span> +</span><br><span class="line">    <span class="comment">// 或者匹配括号内的属性名</span></span><br><span class="line">    <span class="string">'\\[(?:'</span> +</span><br><span class="line">    <span class="comment">// 匹配一个非字符串表达式</span></span><br><span class="line">    <span class="string">'([^"\'][^[]*)'</span> +</span><br><span class="line">    <span class="string">'|'</span> +</span><br><span class="line">    <span class="comment">// 或者是匹配字符串（支持转义字符）</span></span><br><span class="line">    <span class="string">'(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2'</span> +</span><br><span class="line">    <span class="string">')\\]'</span> +</span><br><span class="line">    <span class="string">'|'</span> +</span><br><span class="line">    <span class="comment">// 或者匹配 "" 作为连续 点 或 空括号之间的空白</span></span><br><span class="line">    <span class="string">'(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))'</span>,</span><br><span class="line">  <span class="string">'g'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将一个`string`转化为属性路径数组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>string 要转化的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回属性路径数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// stringToPath是一个缓存函数</span></span><br><span class="line"><span class="keyword">const</span> stringToPath = memoizeCapped(<span class="function">(<span class="params">string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 定义一个空数组result</span></span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="comment">// 当第一个字符为 点 时，push一个''</span></span><br><span class="line">  <span class="keyword">if</span> (string.charCodeAt(<span class="number">0</span>) === charCodeOfDot) &#123;</span><br><span class="line">    result.push(<span class="string">''</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 借用String.prototype的replace方法</span></span><br><span class="line">  <span class="comment">// 第一个参数是正则表达式，第二个参数是创建新的子字符串的函数</span></span><br><span class="line">  <span class="comment">// match是匹配的子串，，substring是被匹配的字符串</span></span><br><span class="line">  string.replace(rePropName, (match, expression, quote, subString) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> key = match;</span><br><span class="line">    <span class="keyword">if</span> (quote) &#123;</span><br><span class="line">      key = subString.replace(reEscapeChar, <span class="string">'$1'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (expression) &#123;</span><br><span class="line">      key = expression.trim();</span><br><span class="line">    &#125;</span><br><span class="line">    result.push(key);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 将result返回</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> stringToPath;</span><br></pre></td></tr></table></figure>

<h3 id="toKey"><a href="#toKey" class="headerlink" title="toKey"></a>toKey</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isSymbol <span class="keyword">from</span> <span class="string">'../isSymbol.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 作为多种`Number`类型常量的引用 */</span></span><br><span class="line"><span class="keyword">const</span> INFINITY = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当`value`不是string或symbol，将`value`转化为字符串key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 要检查的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;string|symbol&#125;</span> </span>返回key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toKey</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当为string或symbol时，直接返回value</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'string'</span> || isSymbol(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 当不是string时，先强制转化为字符串</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="string">`<span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// 当为-0时返回-0，其余直接返回</span></span><br><span class="line">  <span class="keyword">return</span> result == <span class="string">'0'</span> &amp;&amp; <span class="number">1</span> / value == -INFINITY ? <span class="string">'-0'</span> : result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> toKey;</span><br></pre></td></tr></table></figure>

<h2 id="依赖的-lodash-方法"><a href="#依赖的-lodash-方法" class="headerlink" title="依赖的 lodash 方法"></a>依赖的 lodash 方法</h2><h3 id="memoize"><a href="#memoize" class="headerlink" title="memoize"></a>memoize</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 创建一个会缓存 `func` 结果的函数。</span></span><br><span class="line"><span class="comment"> * 如果提供了 `resolver` ，就用 `resolver` 的返回值作为 `key` 缓存函数的结果。</span></span><br><span class="line"><span class="comment"> * 默认情况下用第一个参数作为缓存的 `key`。 `func` 在调用时 `this` 会绑定在缓存函数上。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **注意:** 缓存会暴露在缓存函数的 `cache`属性上。</span></span><br><span class="line"><span class="comment"> * 它是可以定制的，只要替换了 `memoize.Cache` 构造函数，</span></span><br><span class="line"><span class="comment"> * 或实现了 [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)</span></span><br><span class="line"><span class="comment"> * 的 `clear`, `delete`, `get`, `has`, 和 `set`方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>0.1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Function</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>func 需要将输出缓存的函数。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[resolver] 这个函数的返回值作为缓存的 key。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Function&#125;</span> </span>返回新的缓存化后的函数。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const object = &#123; 'a': 1, 'b': 2 &#125;</span></span><br><span class="line"><span class="comment"> * const other = &#123; 'c': 3, 'd': 4 &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const values = memoize(values)</span></span><br><span class="line"><span class="comment"> * values(object)</span></span><br><span class="line"><span class="comment"> * // =&gt; [1, 2]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * values(other)</span></span><br><span class="line"><span class="comment"> * // =&gt; [3, 4]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * object.a = 2</span></span><br><span class="line"><span class="comment"> * values(object)</span></span><br><span class="line"><span class="comment"> * // =&gt; [1, 2]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * // 修改结果缓存</span></span><br><span class="line"><span class="comment"> * values.cache.set(object, ['a', 'b'])</span></span><br><span class="line"><span class="comment"> * values(object)</span></span><br><span class="line"><span class="comment"> * // =&gt; ['a', 'b']</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * // 替换 `memoize.Cache`.</span></span><br><span class="line"><span class="comment"> * memoize.Cache = WeakMap</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">func, resolver</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当func不是函数 || resolver不是函数的时候，报错</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> func !== <span class="string">'function'</span> ||</span><br><span class="line">    (resolver != <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> resolver !== <span class="string">'function'</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Expected a function'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 定义一个函数memoized</span></span><br><span class="line">  <span class="keyword">const</span> memoized = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果resolver存在，就用resolver转化一下参数作为key，否则直接把第一个参数作为key</span></span><br><span class="line">    <span class="keyword">const</span> key = resolver ? resolver.apply(<span class="keyword">this</span>, args) : args[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> cache = memoized.cache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当cache中有key的时候，直接返回该key的值。完成了读取缓存的操作</span></span><br><span class="line">    <span class="keyword">if</span> (cache.has(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// cache没有这个key的时候，就用func执行这些参数</span></span><br><span class="line">    <span class="keyword">const</span> result = func.apply(<span class="keyword">this</span>, args);</span><br><span class="line">    <span class="comment">// 然后在cache设置这个key的值为result，完成了设置缓存操作</span></span><br><span class="line">    memoized.cache = cache.set(key, result) || cache;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 设置memoized这个函数对象的cache属性，默认为一个map</span></span><br><span class="line">  memoized.cache = <span class="keyword">new</span> (memoize.Cache || <span class="built_in">Map</span>)();</span><br><span class="line">  <span class="comment">// 把memoized函数返回</span></span><br><span class="line">  <span class="keyword">return</span> memoized;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">memoize.Cache = <span class="built_in">Map</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> memoize;</span><br></pre></td></tr></table></figure>

<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> baseGet <span class="keyword">from</span> <span class="string">'./.internal/baseGet.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 `object`对象的`path`路径获取值。 如果解析 `value` 是 `undefined` 会以 `defaultValue` 取代。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>3.7.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Object</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>object 要检索的对象。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array|string&#125;</span> </span>path 要获取属性的路径。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>[defaultValue] 如果解析值是 undefined ，defaultValue会被返回。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>返回解析的值。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>has, hasIn, set, unset</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const object = &#123; 'a': [&#123; 'b': &#123; 'c': 3 &#125; &#125;] &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * get(object, 'a[0].b.c')</span></span><br><span class="line"><span class="comment"> * // =&gt; 3</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * get(object, ['a', '0', 'b', 'c'])</span></span><br><span class="line"><span class="comment"> * // =&gt; 3</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * get(object, 'a.b.c', 'default')</span></span><br><span class="line"><span class="comment"> * // =&gt; 'default'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">object, path, defaultValue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// object为null或undefined时，返回undefined，否则返回baseGet</span></span><br><span class="line">  <span class="keyword">const</span> result = object == <span class="literal">null</span> ? <span class="literal">undefined</span> : baseGet(object, path);</span><br><span class="line">  <span class="comment">// result为undefined时，则返回默认值，否则返回result</span></span><br><span class="line">  <span class="keyword">return</span> result === <span class="literal">undefined</span> ? defaultValue : result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">get</span>;</span><br></pre></td></tr></table></figure>

<h2 id="核心内置方法"><a href="#核心内置方法" class="headerlink" title="核心内置方法"></a>核心内置方法</h2><h3 id="basePullAll"><a href="#basePullAll" class="headerlink" title="basePullAll"></a>basePullAll</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> map <span class="keyword">from</span> <span class="string">'../map.js'</span>;</span><br><span class="line"><span class="keyword">import</span> baseIndexOf <span class="keyword">from</span> <span class="string">'./baseIndexOf.js'</span>;</span><br><span class="line"><span class="keyword">import</span> baseIndexOfWith <span class="keyword">from</span> <span class="string">'./baseIndexOfWith.js'</span>;</span><br><span class="line"><span class="keyword">import</span> copyArray <span class="keyword">from</span> <span class="string">'./copyArray.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  `pullAll`系列方法的基础实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>values 要移除值的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[iteratee] iteratee（迭代器）调用每个元素。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[comparator] comparator（比较器）调用每个元素。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">basePullAll</span>(<span class="params">array, values, iteratee, comparator</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用comparator时用baseIndexOfWith，否则用baseIndexOf</span></span><br><span class="line">  <span class="keyword">const</span> indexOf = comparator ? baseIndexOfWith : baseIndexOf;</span><br><span class="line">  <span class="comment">// 拿到要移除数组的长度</span></span><br><span class="line">  <span class="keyword">const</span> length = values.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">-1</span>;</span><br><span class="line">  <span class="comment">// 把array的指针赋给seen</span></span><br><span class="line">  <span class="keyword">let</span> seen = array;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果array和values引用的同一个对象</span></span><br><span class="line">  <span class="keyword">if</span> (array === values) &#123;</span><br><span class="line">    <span class="comment">// 就把values换个地址</span></span><br><span class="line">    values = copyArray(values);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果iteratee参数存在，就把seen的所有元素执行下iteratee后的新数组再返回给seen</span></span><br><span class="line">  <span class="keyword">if</span> (iteratee) &#123;</span><br><span class="line">    seen = map(array, (value) =&gt; iteratee(value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 开始迭代</span></span><br><span class="line">  <span class="keyword">while</span> (++index &lt; length) &#123;</span><br><span class="line">    <span class="keyword">let</span> fromIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> value = values[index];</span><br><span class="line">    <span class="comment">// 当iteratee存在时，则转换下（因为之前把array的转换了，现在需要转换values的），否则返回value</span></span><br><span class="line">    <span class="keyword">const</span> computed = iteratee ? iteratee(value) : value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果在seen（array）中能找到匹配值的索引</span></span><br><span class="line">    <span class="keyword">while</span> ((fromIndex = indexOf(seen, computed, fromIndex, comparator)) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="comment">// 也就是iteratee参数存在</span></span><br><span class="line">      <span class="keyword">if</span> (seen !== array) &#123;</span><br><span class="line">        <span class="comment">// 则从seen中删去该值</span></span><br><span class="line">        seen.splice(fromIndex, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// array中也删去该值</span></span><br><span class="line">      array.splice(fromIndex, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 内层while执行完后，就决定当前的元素要不要删</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 外层while执行完后，就决定了array中每一个元素要不要删</span></span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> basePullAll;</span><br></pre></td></tr></table></figure>

<h3 id="basePullAt"><a href="#basePullAt" class="headerlink" title="basePullAt"></a>basePullAt</h3><p>该方法有 <code>bug</code>，本系列全部完成后给 lodash 统一提个 pull request 吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> baseUnset <span class="keyword">from</span> <span class="string">'./baseUnset.js'</span>;</span><br><span class="line"><span class="keyword">import</span> isIndex <span class="keyword">from</span> <span class="string">'./isIndex.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `pullAt`方法的基础实现，不支持单独的索引或捕获被移除的元素</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要修改的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> </span>indexes 要删除元素的索引数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 注意： 传到indexes中的数组必须已经排序过，不然会出bug</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">basePullAt</span>(<span class="params">array, indexes</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  <span class="keyword">let</span> length = array ? indexes.length : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> lastIndex = length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始从右向左循环</span></span><br><span class="line">  <span class="keyword">while</span> (length--) &#123;</span><br><span class="line">    <span class="comment">// 此处有bug，应该移到while循环外，否则每次的previous都是重新定义的</span></span><br><span class="line">    <span class="keyword">let</span> previous;</span><br><span class="line">    <span class="comment">// index是当前迭代的索引</span></span><br><span class="line">    <span class="keyword">const</span> index = indexes[length];</span><br><span class="line">    <span class="comment">// 当length === lastIndex，是让第一次循环能执行</span></span><br><span class="line">    <span class="comment">// 或 index !== previous时，是让后来能运行，因为indexes其实已经排序过了，</span></span><br><span class="line">    <span class="comment">// 所以只用跟前一个元素比较看看有没有重复就可以了，重复就跳过</span></span><br><span class="line">    <span class="keyword">if</span> (length === lastIndex || index !== previous) &#123;</span><br><span class="line">      <span class="comment">// 让previous等于index</span></span><br><span class="line">      previous = index;</span><br><span class="line">      <span class="comment">// 删除该位置的索引</span></span><br><span class="line">      <span class="keyword">if</span> (isIndex(index)) &#123;</span><br><span class="line">        array.splice(index, <span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        baseUnset(array, index);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> basePullAt;</span><br></pre></td></tr></table></figure>

<p>对比打包好的 lodash 库中的 <code>basePullAt</code>，其实是掩盖了bug存在的。如果直接执行<code>basePullAt</code>源码，错误就会暴露出来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">basePullAt</span>(<span class="params">array, indexes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> length = array ? indexes.length : <span class="number">0</span>,</span><br><span class="line">    lastIndex = length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (length--) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = indexes[length];</span><br><span class="line">    <span class="keyword">if</span> (length == lastIndex || index !== previous) &#123;</span><br><span class="line">      <span class="comment">// 对比可以发现，此处的previous是使用var定义，并且定义的位置</span></span><br><span class="line">      <span class="comment">// 放在了if判断的后面，导致if判断依然能生效，掩盖了bug</span></span><br><span class="line">      <span class="keyword">var</span> previous = index;</span><br><span class="line">      <span class="keyword">if</span> (isIndex(index)) &#123;</span><br><span class="line">        splice.call(array, index, <span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        baseUnset(array, index);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="pull-家族"><a href="#pull-家族" class="headerlink" title="pull 家族"></a>pull 家族</h2><h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pullAll <span class="keyword">from</span> <span class="string">'./pullAll.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除数组`array`中所有和给定值相等的元素，</span></span><br><span class="line"><span class="comment"> * 使用 [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero) 进行全等比较。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **注意：** 和 `without` 方法不同，这个方法会改变数组。通过断言使用 `remove` 从一个数组中移除元素。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>2.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Array</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;...*&#125;</span> </span>[values] 要删除的值。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>pullAll, pullAllBy, pullAllWith, pullAt, remove, reject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const array = ['a', 'b', 'c', 'a', 'b', 'c']</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * pull(array, 'a', 'c')</span></span><br><span class="line"><span class="comment"> * console.log(array)</span></span><br><span class="line"><span class="comment"> * // =&gt; ['b', 'b']</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pull</span>(<span class="params">array, ...values</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 核心调用的pullAll</span></span><br><span class="line">  <span class="keyword">return</span> pullAll(array, values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pull;</span><br></pre></td></tr></table></figure>

<h3 id="pullAll"><a href="#pullAll" class="headerlink" title="pullAll"></a>pullAll</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> basePullAll <span class="keyword">from</span> <span class="string">'./.internal/basePullAll.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法类似_.pull，区别是这个方法接收一个要移除值的数组。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   **注意：** 和 `difference` 方法不同，这个方法会改变数组。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>4.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Array</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array  要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>values 要移除值的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>pull, pullAllBy, pullAllWith, pullAt, remove, reject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const array = ['a', 'b', 'c', 'a', 'b', 'c']</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * pullAll(array, ['a', 'c'])</span></span><br><span class="line"><span class="comment"> * console.log(array)</span></span><br><span class="line"><span class="comment"> * // =&gt; ['b', 'b']</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pullAll</span>(<span class="params">array, values</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// array和value有值 &amp;&amp; array和value有长度</span></span><br><span class="line">  <span class="keyword">return</span> array != <span class="literal">null</span> &amp;&amp; array.length &amp;&amp; values != <span class="literal">null</span> &amp;&amp; values.length</span><br><span class="line">    ? <span class="comment">// 满足则调用basePullAll</span></span><br><span class="line">      basePullAll(array, values)</span><br><span class="line">    : array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pullAll;</span><br></pre></td></tr></table></figure>

<h3 id="pullAllBy"><a href="#pullAllBy" class="headerlink" title="pullAllBy"></a>pullAllBy</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> basePullAll <span class="keyword">from</span> <span class="string">'./.internal/basePullAll.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法类似于 `pullAll` ，区别是这个方法接受一个 `iteratee`（迭代函数）</span></span><br><span class="line"><span class="comment"> * 调用 `array` 和 `values`的每个值以产生一个值，通过产生的值进行了比较。</span></span><br><span class="line"><span class="comment"> * iteratee 会传入一个参数： (value)。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **注意:** 不同于 `differenceBy`, 这个方法会改变数组 array。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>4.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Array</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array The array to modify.要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>values The values to remove.要移除值的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>iteratee iteratee（迭代器）调用每个元素。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>pull, pullAll, pullAllWith, pullAt, remove, reject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const array = [&#123; 'x': 1 &#125;, &#123; 'x': 2 &#125;, &#123; 'x': 3 &#125;, &#123; 'x': 1 &#125;]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * pullAllBy(array, [&#123; 'x': 1 &#125;, &#123; 'x': 3 &#125;], 'x')</span></span><br><span class="line"><span class="comment"> * console.log(array)</span></span><br><span class="line"><span class="comment"> * // =&gt; [&#123; 'x': 2 &#125;]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pullAllBy</span>(<span class="params">array, values, iteratee</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// array和value有值 &amp;&amp; array和value有长度</span></span><br><span class="line">  <span class="keyword">return</span> array != <span class="literal">null</span> &amp;&amp; array.length &amp;&amp; values != <span class="literal">null</span> &amp;&amp; values.length</span><br><span class="line">    ? <span class="comment">// 满足则调用basePullAll，但是多加参数iteratee</span></span><br><span class="line">      basePullAll(array, values, iteratee)</span><br><span class="line">    : array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pullAllBy;</span><br></pre></td></tr></table></figure>

<h3 id="pullAllWith"><a href="#pullAllWith" class="headerlink" title="pullAllWith"></a>pullAllWith</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> basePullAll <span class="keyword">from</span> <span class="string">'./.internal/basePullAll.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这个方法类似于 `pullAll` ，区别是这个方法接受 comparator</span></span><br><span class="line"><span class="comment"> * 调用array中的元素和values比较。</span></span><br><span class="line"><span class="comment"> * comparator 会传入两个参数：(arrVal, othVal)。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **注意:** 不同于 `differenceWith`, 这个方法会改变数组 array。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>4.6.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Array</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>values 要移除值的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[comparator] comparator（比较器）调用每个元素。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回 `array`.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>pull, pullAll, pullAllBy, pullAt, remove, reject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const array = [&#123; 'x': 1, 'y': 2 &#125;, &#123; 'x': 3, 'y': 4 &#125;, &#123; 'x': 5, 'y': 6 &#125;]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * pullAllWith(array, [&#123; 'x': 3, 'y': 4 &#125;], isEqual)</span></span><br><span class="line"><span class="comment"> * console.log(array)</span></span><br><span class="line"><span class="comment"> * // =&gt; [&#123; 'x': 1, 'y': 2 &#125;, &#123; 'x': 5, 'y': 6 &#125;]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pullAllWith</span>(<span class="params">array, values, comparator</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// array和value有值 &amp;&amp; array和value有长度</span></span><br><span class="line">  <span class="keyword">return</span> array != <span class="literal">null</span> &amp;&amp; array.length &amp;&amp; values != <span class="literal">null</span> &amp;&amp; values.length</span><br><span class="line">    ? <span class="comment">// 满足则调用basePullAll，但是多加参数comparator</span></span><br><span class="line">      basePullAll(array, values, <span class="literal">undefined</span>, comparator)</span><br><span class="line">    : array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pullAllWith;</span><br></pre></td></tr></table></figure>

<h3 id="pullAt"><a href="#pullAt" class="headerlink" title="pullAt"></a>pullAt</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> map <span class="keyword">from</span> <span class="string">'./map.js'</span>;</span><br><span class="line"><span class="keyword">import</span> baseAt <span class="keyword">from</span> <span class="string">'./.internal/baseAt.js'</span>;</span><br><span class="line"><span class="keyword">import</span> basePullAt <span class="keyword">from</span> <span class="string">'./.internal/basePullAt.js'</span>;</span><br><span class="line"><span class="keyword">import</span> compareAscending <span class="keyword">from</span> <span class="string">'./.internal/compareAscending.js'</span>;</span><br><span class="line"><span class="keyword">import</span> isIndex <span class="keyword">from</span> <span class="string">'./.internal/isIndex.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引 `indexes`，移除`array`中对应的元素，并返回被移除元素的数组。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **注意:** 和 `at`不同, 这个方法会改变数组 `array`。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since </span>3.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category <span class="variable">Array</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>array 要修改的数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;...(number|number[])&#125;</span> </span>[indexes] 要移除元素的索引。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>返回移除元素组成的新数组。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>pull, pullAll, pullAllBy, pullAllWith, remove, reject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const array = ['a', 'b', 'c', 'd']</span></span><br><span class="line"><span class="comment"> * const pulled = pullAt(array, [1, 3])</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * console.log(array)</span></span><br><span class="line"><span class="comment"> * // =&gt; ['a', 'c']</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * console.log(pulled)</span></span><br><span class="line"><span class="comment"> * // =&gt; ['b', 'd']</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pullAt</span>(<span class="params">array, ...indexes</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 取到length</span></span><br><span class="line">  <span class="keyword">const</span> length = array == <span class="literal">null</span> ? <span class="number">0</span> : array.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = baseAt(array, indexes);</span><br><span class="line"></span><br><span class="line">  basePullAt(</span><br><span class="line">    array,</span><br><span class="line">    map(indexes, (index) =&gt; (isIndex(index, length) ? +index : index)).sort(</span><br><span class="line">      compareAscending</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pullAt;</span><br></pre></td></tr></table></figure>

<h2 id="原生实现"><a href="#原生实现" class="headerlink" title="原生实现"></a>原生实现</h2><p><code>pull</code>方法的原生实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原生实现</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pull</span>(<span class="params">arr, ...removeList</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用set首先能对removeList去重</span></span><br><span class="line">  <span class="comment">// 第二set自带增删查改等各种方法</span></span><br><span class="line">  <span class="keyword">let</span> removeSet = <span class="keyword">new</span> <span class="built_in">Set</span>(removeList);</span><br><span class="line">  <span class="comment">// 直接对arr过滤，如果set中有该元素，就过滤掉。</span></span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !removeSet.has(el);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(pull(array, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="comment">// [1, 1]</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="林景宜 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="林景宜 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/lodash/" rel="tag"># lodash</a>
              <a href="/tags/%E6%BA%90%E7%A0%81/" rel="tag"># 源码</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/ece7a93f.html" rel="prev" title="lodash源码解析：intersection家族">
      <i class="fa fa-chevron-left"></i> lodash源码解析：intersection家族
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖的内置方法"><span class="nav-number">1.</span> <span class="nav-text">依赖的内置方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#baseAt"><span class="nav-number">1.1.</span> <span class="nav-text">baseAt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baseGet"><span class="nav-number">1.2.</span> <span class="nav-text">baseGet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baseIndexOfWith"><span class="nav-number">1.3.</span> <span class="nav-text">baseIndexOfWith</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baseUnset"><span class="nav-number">1.4.</span> <span class="nav-text">baseUnset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#castPath"><span class="nav-number">1.5.</span> <span class="nav-text">castPath</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compareAscending"><span class="nav-number">1.6.</span> <span class="nav-text">compareAscending</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#copyArrayAt"><span class="nav-number">1.7.</span> <span class="nav-text">copyArrayAt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#isKey"><span class="nav-number">1.8.</span> <span class="nav-text">isKey</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memoizeCapped"><span class="nav-number">1.9.</span> <span class="nav-text">memoizeCapped</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#parent"><span class="nav-number">1.10.</span> <span class="nav-text">parent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stringToPath"><span class="nav-number">1.11.</span> <span class="nav-text">stringToPath</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#toKey"><span class="nav-number">1.12.</span> <span class="nav-text">toKey</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖的-lodash-方法"><span class="nav-number">2.</span> <span class="nav-text">依赖的 lodash 方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#memoize"><span class="nav-number">2.1.</span> <span class="nav-text">memoize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get"><span class="nav-number">2.2.</span> <span class="nav-text">get</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心内置方法"><span class="nav-number">3.</span> <span class="nav-text">核心内置方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#basePullAll"><span class="nav-number">3.1.</span> <span class="nav-text">basePullAll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#basePullAt"><span class="nav-number">3.2.</span> <span class="nav-text">basePullAt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pull-家族"><span class="nav-number">4.</span> <span class="nav-text">pull 家族</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pull"><span class="nav-number">4.1.</span> <span class="nav-text">pull</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pullAll"><span class="nav-number">4.2.</span> <span class="nav-text">pullAll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pullAllBy"><span class="nav-number">4.3.</span> <span class="nav-text">pullAllBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pullAllWith"><span class="nav-number">4.4.</span> <span class="nav-text">pullAllWith</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pullAt"><span class="nav-number">4.5.</span> <span class="nav-text">pullAt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原生实现"><span class="nav-number">5.</span> <span class="nav-text">原生实现</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="林景宜" src="/images/bangchui-logo.svg">
  <p class="site-author-name" itemprop="name">林景宜</p>
  <div class="site-description" itemprop="description">一个已婚的前端er</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/MagnetLin" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;MagnetLin" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:linjingyi321@qq.com" title="E-Mail → mailto:linjingyi321@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">吉ICP备17007191号-2 </a>
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">林景宜</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'b82a041b865a317f34ae',
      clientSecret: 'c392fb3d75a89b073e3dfe301a85b6f981c8ea86',
      repo: 'MagnetLinComments',
      owner: 'MagnetLin',
      admin: ['MagnetLin'],
      id: '032a18b98613d3c90e52eee237aa5dab',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
